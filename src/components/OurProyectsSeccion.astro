<section id="projects-section" class="bg-gray-100 dark:bg-dark-800 pt-24 h-screen w-screen transition-colors duration-300">
  <div class="container mx-auto px-4 py-12">
    <!-- Encabezado con título y línea amarilla -->
    <header class="flex flex-col items-center pb-2 text-center">
      <div class="relative inline-block">
        <h2 class="text-3xl font-sans font-bold">
          <span class="text-black dark:text-white">Our </span>
          <span class="text-yellow-500 dark:text-yellow-400">Projects</span>
        </h2>
        <div
          id="projects-underline"
          class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-[50%] h-1 bg-yellow-400 dark:bg-yellow-500 origin-center scale-x-0 transition-colors duration-300"
          style="bottom: -8px;"
        ></div>
      </div>
      <h3 class="mt-4 max-w-xl text-center font-sans text-black dark:text-gray-300 text-sm transition-colors duration-300">
        We take pride in our diverse portfolio of successful projects across Hawaii. Each project reflects our
        commitment to quality, precision, and customer satisfaction.
      </h3>
    </header>

    <!-- Carrusel -->
    <div class="relative mt-8 max-w-screen-xl mx-auto overflow-hidden font-sans w-full">
      <div class="overflow-hidden w-full">
        <div class="flex transition-transform duration-300 ease-in-out" id="carousel">
          <!-- Tarjeta 1 -->
          <div class="flex-none w-full p-2">
            <article class="bg-white dark:bg-dark-700 shadow-lg dark:shadow-dark-900 rounded-lg h-[350px] w-full transition-all duration-300 hover:shadow-xl dark:hover:shadow-dark-600">
              <img src="/images/maquina1.webp" alt="Excavation" class="w-full h-[198px] object-cover rounded" />
              <h4 class="font-semibold text-lg pl-4 text-start text-black dark:text-white">Residential Land clearing</h4>
              <p class="text-xs pl-4 text-start text-black dark:text-gray-300 transition-colors duration-300">
                Complete land clearing for a new residential development in Captain Cook.
              </p>
              <a href="#" class="pt-2 pl-4 pb-1 text-sm text-start text-yellow-500 dark:text-yellow-400 hover:underline mt-5 block transition-colors duration-300"
                >View details</a
              >
            </article>
          </div>

          <!-- Tarjeta 2 -->
          <div class="flex-none w-full p-2">
            <article class="bg-white dark:bg-dark-700 shadow-lg dark:shadow-dark-900 rounded-lg h-[350px] w-full transition-all duration-300 hover:shadow-xl dark:hover:shadow-dark-600">
              <img src="/images/maquina1.webp" alt="Excavation" class="w-full h-[198px] object-cover rounded" />
              <h4 class="font-semibold text-lg pl-4 text-start text-black dark:text-white">Commercial Site Excavation</h4>
              <p class="text-xs pl-4 text-start text-black dark:text-gray-300 transition-colors duration-300">
                Precision excavation for a new commercial building foundation.
              </p>
              <a href="#" class="pt-2 pl-4 pb-1 text-sm text-start text-yellow-500 dark:text-yellow-400 hover:underline mt-5 block transition-colors duration-300"
                >View details</a
              >
            </article>
          </div>

          <!-- Tarjeta 3 -->
          <div class="flex-none w-full p-2">
            <article class="bg-white dark:bg-dark-700 shadow-lg dark:shadow-dark-900 rounded-lg h-[350px] w-full transition-all duration-300 hover:shadow-xl dark:hover:shadow-dark-600">
              <img src="/images/maquina1.webp" alt="Excavation" class="w-full h-[198px] object-cover rounded" />
              <h4 class="font-semibold text-lg pl-4 text-start text-black dark:text-white">Agricultural Water Delivery</h4>
              <p class="text-xs pl-4 text-start text-black dark:text-gray-300 transition-colors duration-300">
                Non-potable water delivery for a large agricultural operation.
              </p>
              <a href="#" class="pt-2 pl-4 pb-1 text-sm text-start text-yellow-500 dark:text-yellow-400 hover:underline mt-5 block transition-colors duration-300"
                >View details</a
              >
            </article>
          </div>

          <!-- Tarjeta 4 -->
          <div class="flex-none w-full p-2">
            <article class="bg-white dark:bg-dark-700 shadow-lg dark:shadow-dark-900 rounded-lg h-[350px] w-full transition-all duration-300 hover:shadow-xl dark:hover:shadow-dark-600">
              <img src="/images/maquina1.webp" alt="Excavation" class="w-full h-[198px] object-cover rounded" />
              <h4 class="font-semibold text-lg pl-4 text-start text-black dark:text-white">Utility Trenching Project</h4>
              <p class="text-xs pl-4 text-start text-black dark:text-gray-300 transition-colors duration-300">
                Precise trenching for new utility lines in a developing neighborhood.
              </p>
              <a href="#" class="pt-2 pl-4 pb-1 text-sm text-start text-yellow-500 dark:text-yellow-400 hover:underline mt-5 block transition-colors duration-300"
                >View details</a
              >
            </article>
          </div>
        </div>
      </div>

      <!-- Botones del carrusel -->
      <button
        id="prevBtn"
        class="absolute top-1/2 left-[10px] transform -translate-y-1/2 bg-white/40 dark:bg-dark-600/60 hover:bg-white/60 dark:hover:bg-dark-500/80 text-black dark:text-white backdrop-blur-md p-3 rounded-full shadow-md z-10 transition duration-200"
      >
        &#10094;
      </button>
      <button
        id="nextBtn"
        class="absolute top-1/2 right-[15px] transform -translate-y-1/2 bg-white/40 dark:bg-dark-600/60 hover:bg-white/60 dark:hover:bg-dark-500/80 text-black dark:text-white backdrop-blur-md p-3 rounded-full shadow-md z-10 transition duration-200"
      >
        &#10095;
      </button>
    </div>

    <!-- Footer -->
    <footer class="py-10 text-center">
      <a
        href="#"
        class="flex-1 bg-yellow-500 dark:bg-yellow-500 text-white font-sans uppercase text-sm font-semibold py-3 px-5 rounded-lg hover:bg-yellow-600 dark:hover:bg-yellow-600 transition-colors duration-300"
      >
        Contact Us
      </a>
    </footer>
  </div>

  <style>
    #projects-underline {
      transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    .animate-underline {
      animation: lineBounce 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
    }
    @keyframes lineBounce {
      0% {
        transform: translateX(-50%) scaleX(0);
        height: 2px;
      }
      60% {
        transform: translateX(-50%) scaleX(1.2);
        height: 5px;
      }
      100% {
        transform: translateX(-50%) scaleX(1);
        height: 3px;
      }
    }
  </style>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Definición de tipos para los elementos del DOM
    const carousel = document.getElementById("carousel") as HTMLElement | null;
    const nextBtn = document.getElementById("nextBtn") as HTMLButtonElement | null;
    const prevBtn = document.getElementById("prevBtn") as HTMLButtonElement | null;

    if (!carousel || !nextBtn || !prevBtn) {
      console.error("Carousel elements not found");
      return;
    }

    // Constantes con tipos explícitos
    const itemsVisible: number = 3;
    const itemsToScroll: number = 1;
    let slides: HTMLElement[] = Array.from(carousel.children) as HTMLElement[];
    const originalSlidesCount: number = slides.length;
    let currentIndex: number = itemsVisible;
    let autoSlideInterval: number | undefined;

    // Función con tipos explícitos
    function getSlideWidth(slideElement: HTMLElement): number {
      return slideElement ? slideElement.offsetWidth || 0 : 0;
    }

    // Configuración inicial de slides
    slides.forEach((slide: HTMLElement) => {
      slide.style.width = `${100 / itemsVisible}%`;
    });

    // Clonación de slides con tipos adecuados
    const clonesStart: HTMLElement[] = slides.slice(-itemsVisible).map(s => s.cloneNode(true) as HTMLElement);
    const clonesEnd: HTMLElement[] = slides.slice(0, itemsVisible).map(s => s.cloneNode(true) as HTMLElement);

    clonesStart.forEach(clone => carousel.insertBefore(clone, carousel.firstChild));
    clonesEnd.forEach(clone => carousel.appendChild(clone));

    slides = Array.from(carousel.children) as HTMLElement[];

    // Función de actualización con tipos
    function updateCarousel(withTransition: boolean): void {
      const slideElement = slides[currentIndex];
      const slideWidth = getSlideWidth(slideElement);

      carousel!.style.transition = withTransition ? "transform 0.5s ease-in-out" : "none";
      carousel!.style.transform = `translateX(-${slideWidth * currentIndex}px)`;
    }

    // Funciones de navegación
    function nextSlide(): void {
      if (currentIndex < slides.length - itemsVisible) {
        currentIndex += itemsToScroll;
        updateCarousel(true);
      }
    }

    function prevSlide(): void {
      if (currentIndex > 0) {
        currentIndex -= itemsToScroll;
        updateCarousel(true);
      }
    }

    // Control del auto-desplazamiento
    function startAutoSlide(): void {
      autoSlideInterval = window.setInterval(() => {
        nextSlide();
      }, 5000);
    }

    function resetAutoSlide(): void {
      if (autoSlideInterval !== undefined) {
        clearInterval(autoSlideInterval);
      }
      startAutoSlide();
    }

    // Event listeners
    carousel.addEventListener("transitionend", () => {
      if (currentIndex >= originalSlidesCount + itemsVisible) {
        currentIndex = itemsVisible;
        updateCarousel(false);
      } else if (currentIndex < itemsVisible) {
        currentIndex = originalSlidesCount;
        updateCarousel(false);
      }
    });

    nextBtn.addEventListener("click", () => {
      nextSlide();
      resetAutoSlide();
    });

    prevBtn.addEventListener("click", () => {
      prevSlide();
      resetAutoSlide();
    });

    // Inicialización
    updateCarousel(false);
    startAutoSlide();

    // Limpieza
    window.addEventListener("beforeunload", () => {
      if (autoSlideInterval !== undefined) {
        clearInterval(autoSlideInterval);
      }
    });
  });
</script>